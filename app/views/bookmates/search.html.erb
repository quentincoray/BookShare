<% if @users_near_me.length == 0 %>
  <div class="container-search">
    <div class="span">
      <p>Il n'y a pas de bookmates près de chez vous pour le moment !</p>
      <p>Nouvelle recherche !</p>
      <div class="span-form">
        <%= render '/pages/search_form' %>
      </div>
    </div>
  </div>
<% else %>
  <div class="container-search">
  <!-- Bloc map et cards -->
    <div class="row">
      <% if @bookmates_matching.exists? %>
        <h1 class ="red">Découvrez les personnes proches de vous avec qui vous partagez le plus d'affinités littéraires</h1>
      <% else %>
        <h1 class="red">Découvrez les personnes proches de vous!</h1>
      <% end %>
        <!-- Bloc cards -->
        <div class="col-xs-7" id="card-column">
          <% @bookmates_selected.each do |bookmate|%>
            <!-- Carte utilisateur -->
            <div class="position-relative">
              <%= link_to bookmate_path(bookmate) do %>
                <div class="card-grey-search">
                  <div class="user-avatar text-center">
                    <div class = "card-user text-center">
                      <% if bookmate.user.photo? %>
                        <%= cl_image_tag bookmate.user.photo.path,:width=>80, :height=>80, :gravity=>"auto", :crop=>"fill" %>
                      <% else %>
                        <%= image_tag 'avatar.png',:width=>80, :height=>80, :gravity=>"auto", :crop=>"fill" %>
                      <% end %>
                    </div>
                    <h2><%= bookmate.user.first_name %></h2>
                  </div>
                  <div class="user-details">
                    <h2>A propos de <%= bookmate.user.first_name %></h2>
                    <p>" <%= bookmate.description %> "</p>
                    <h2 style="padding-left: 30vh">
                      <p class="green"><%= pluralize bookmate.review_count, "commentaire" %></p>

                      <% if bookmate.average_rating %>
                        <% bookmate.average_rating.times do %>
                          <i class="fa fa-star blue"></i>
                        <% end %>
                        <% (5 - bookmate.average_rating).times do %>
                          <i class="fa fa-star grey"></i>
                        <% end %>
                      <% end %>
                    </h2>
                    <% if bookmate.respond_to?(:common_books) %>
                      <div class="user-details-books">
                        <h2 class="blue" ><%= pluralize bookmate.common_books, "livre" %> en commun</h2>
                      </div>
                    <% end %>
                    </div>
                  <div class="user-link">
                    <i class="fa fa-chevron-circle-right fa-2x" aria-hidden="true"></i>
                  </div>
                </div>
                </div>
              <% end %>
            <% end %>
          </div>
        <div class="col-xs-5" id="map-column">
          <div id="map"></div>
        </div>
      </div>
  </div>
<% end %>

<% content_for(:after_js) do %>
  <%= javascript_tag do %>
    $(document).ready(function () {
      <!-- $('#footer').remove(); -->
      var handler = Gmaps.build ('Google');
      handler.buildMap({ internal: { id: 'map' } }, function() {
        markers = handler.addMarkers(<%= raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
        if (markers.length == 0) {
          handler.getMap().setZoom(3);
        } else if (markers.length == 1) {
          handler.getMap().setZoom(14);
        }
      });
    });
  <% end %>
<% end %>


